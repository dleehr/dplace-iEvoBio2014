<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Dan Leehr - iEvoBio 2014</title>

		<meta name="description" content="Integrating Geospatial functionality into a database of human cultural diversity">
		<meta name="author" content="Dan Leehr">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="css/reveal.min.css">
		<link rel="stylesheet" href="css/theme/default.css" id="theme">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">
		
		<!-- jVectorMap CSS-->
		<link rel="stylesheet" href="lib/css/jquery-jvectormap-1.1.1.css">

		<!-- If the query includes 'print-pdf', include the PDF print sheet -->
		<script>
			if( window.location.search.match( /print-pdf/gi ) ) {
				var link = document.createElement( 'link' );
				link.rel = 'stylesheet';
				link.type = 'text/css';
				link.href = 'css/print/pdf.css';
				document.getElementsByTagName( 'head' )[0].appendChild( link );
			}
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
<div class="slides">
    <section class="" data-id="47931731a25a16a9cead63a648ed8621">
        <h1>D-PLACE</h1>
        <h2>
        Integrating Geospatial functionality<br>
        into a database of human<br>
        cultural diversity</h2>
        <br>

<p>
Dan Leehr<br>
National Evolutionary Synthesis Center<br>
<p><span>&nbsp;</span></p>
<p>
iEvoBio 2014<br>
<a href="https://dleehr.github.io/dplace-iEvoBio2014">https://dleehr.github.io/dplace-iEvoBio2014</a><br>
</p>

</section>
<section>
    <h1>Working Group</h1>
<div>
<p><a href="http://nescent.org/science/awards_summary.php?id=400">Explaining cultural diversity: A new evolutionary synthesis</a></p>
<ul>
  <li>Michael Gavin (Colorado State University)</li>
  <li>Simon Greenhill (Australian National University)</li>
  <li>Fiona Jordan (University of Bristol)</li>
  <li>Russell Gray (The University of Auckland)</li>
</ul>
<br>
</section>
  <section>
    <h1>Data</h1>
    <ul>
      <li>Spreadsheets
      <ul><li>Cultural, Environmental, Language, Geographic</li></ul>
      <li>Shapefiles</li>
    </ul>
    <div class="fragment">
      <pre><code>Geometry: Polygon
  Feature Count: 52
  Extent: (-180.000000, -90.000000) - (180.000000, 83.623596)
  LEVEL_2_RE: Real (16.6)
  COUNT: Real (11.0)
  REGION_NAM: String (254.0)
  CONTINENT: String (254.0)
  TDWG_CODE: Integer (4.0)
  OGRFeature(level2):0
  &nbsp; LEVEL_2_RE (Real) = 10.000000
  &nbsp; COUNT (Real) = 89
  &nbsp; REGION_NAM (String) = Northern Europe
  &nbsp; CONTINENT (String) = EUROPE
  &nbsp; TDWG_CODE (Integer) = 10
  &nbsp; MULTIPOLYGON (((12.183610916137695 54.880271911621094,12.163610458374023 54.883049011230469,12.150833129882812 54.8861083984375,12.115833282470703 54.904159545898438,12.132221221923828 54.951385498046875,12.135831832885742&nbsp; </code></pre>
  </div>
  </section>
<section class="stack">
  <section>
  <h1>
    <span>Backend</span>
  </h1>
  </section>
  <section>
  <h1>
    <span>Django</span>
  </h1>
    <h2><span>Python Framework</span></h2>
  </section>
  <section>
  <h1><span>Stack</span></h1>
    <table style="margin-left: auto; margin-right: auto;">
      <tr>
        <td>Code</td><td>&#8594;</td><td>Python</td></tr>
        <td>Data</td><td>&#8594;</td><td>PostgreSQL</td></tr>
        <td>GIS</td><td>&#8594;</td><td>PostGIS + GeoDjango</td></tr>
        <td>JSON</td><td>&#8594;</td><td>Django REST Framework</td></tr>
      </tr>
    </table>
  </section>

  <section>
  <h1><span>Why?</span></h1>
  <div>
    <ul>
      <li>Python &#8594; <a href="http://bit.ly/1jAXbwv">LMGTFY</a>
      <li>Django &#8594; Great data modeling</li>
      <li>GIS &#8594; Querying like this:<br><pre><code>Society.objects.where(region__intersects=q)</code></pre>
      </li>
      <li>JSON &#8594; All clients are API clients</li>
    </ul>
  </div>
  </section>
  <section>
    <h1>Model</h1>
    <h2>From Shapefile</h2>
    <div>
      <pre><code>manage.py ogrinspect level2.shp GeographicRegion --srid=4326 
                 --mapping --multi</code></pre>
    </div>
    <div><br></div>
    <div class="fragment" data-fragment-index="1">
      <p>Generates:</p>
      <pre><code>class GeographicRegion(models.Model):
      &nbsp; &nbsp; level_2_re = models.FloatField()
      &nbsp; &nbsp; count = models.FloatField()
      &nbsp; &nbsp; region_nam = models.CharField(max_length=254)
      &nbsp; &nbsp; continent = models.CharField(max_length=254)
      &nbsp; &nbsp; tdwg_code = models.IntegerField()
      &nbsp; &nbsp; geom = models.MultiPolygonField(srid=4326)
      &nbsp; &nbsp; objects = models.GeoManager()</code></pre>
    </div>
  </section>

  <section>
    <h1>JSON Client</h1>
    <div>
      <pre><code>$ curl -s http://localhost:8000/api/v1/geographic_regions/&nbsp;&#10552;
      &nbsp; &nbsp; ?region_nam=Pacific
      {
      &nbsp; &nbsp; "count": 4,
      &nbsp; &nbsp; "next": null,
      &nbsp; &nbsp; "previous": null,
      &nbsp; &nbsp; "results": [
      &nbsp; &nbsp; &nbsp; &nbsp; {
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "continent": "PACIFIC",
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "count": 59.0,
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "id": 31,
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "level_2_re": 60.0,
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "region_nam": "Southwestern Pacific",
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "tdwg_code": 60
      &nbsp; &nbsp; &nbsp; &nbsp; },
      &nbsp; &nbsp; &nbsp; &nbsp; ...
      &nbsp; &nbsp; ]
      }</code></pre>
      <p>Intuitive filtering, including geography</p>
    </div>
  </section>
</section>
<section class="stack">
  <section>
  <h1>
    <span>Frontend</span>
  </h1>
  </section>
  <section>
  <h1>
    <span>AngularJS</span>
  </h1>
  <div>
  <p>Declarative, not Deformative
  </p>
  </div>
  </section>
  <section>
  <h1><span>Stack</span></h1>
    <table style="margin-left: auto; margin-right: auto;">
      <tr>
        <td>Code</td><td>&#8594;</td><td>JavaScript</td></tr>
        <td>UI</td><td>&#8594;</td><td>Bootstrap</td></tr>
        <td>Data</td><td>&#8594;</td><td>JSON</td></tr>
        <td>Maps</td><td>&#8594;</td><td>jVectorMap</td></tr>
      </tr>
    </table>
  </section>
  <section>
    <h1><span>Why?</span></h1>  
    <div>
      <ul>
        <li>AngularJS &#8594; Markup becomes dynamic</li>
        <li>JSON Data &#8594; AngularJS app just a REST client<br>
        <pre><code>FindSocieties.find({ geographic_regions: geographicRegions }, ...)</code></pre>
        </li>
        <li>jVectorMap &#8594; Sensible JS API, Vectors!</li>
      </ul>
    </div>
  </section>
  <section>
    <script src="lib/js/jquery-1.11.1.min.js"></script>
    <script src="lib/js/jquery-jvectormap-1.2.2.min.js"></script>
    <script src="lib/js/tdwg-level2-map.js"></script>
    <h1>Map</h1>
    <p>From Shapefile</p>
    <div><pre><code>converter.py --width 1000 --country_code_index 4 --country_name_index 2
      level2.shp tdwg-level2-map.js </code></pre>
    </div>
  <div><p>To javascript</p></div>
  <div data-fragment-index="0" class="fragment" style="width:100%; height:500px;" id="mapdiv"></div>
  <script>
        $('#mapdiv').vectorMap({
          map: 'tdwg-level2',
          backgroundColor: 'clear',
          regionStyle: {
            initial: {
              fill: '#428bca',
              "fill-opacity": 1,
              stroke: '#357ebd',
              "stroke-width": 0,
              "stroke-opacity": 1
            },
            hover: {
              "fill-opacity": 0.8
            },
            selected: {
              fill: '#113'
            },
            selectedHover: {
            }
          },
          regionsSelectable: true
          });
  </script>
  </section>
  <section>
    <h1>AngularJS</h1>
    <ul>
      <li>Application framework</li>
      <li>Talks to REST APIs</li>
      <li>Wrap up custom code in directives<br>
        <pre class="fragment"><code>&lt;dplace-map 
        selected-regions="regions"/&gt;
&lt;ul&gt;    
  &lt;li ng-repeat="region in regions"&gt; 
  {{ region.name }}
  &lt;/li&gt;
&lt;/ul&gt;    
        </code></pre>
      </li>
    </ul>
  </section>
</section>
<section>
  <h1>Dependency Monster</h1>
</section>
<section data-autoslide="7500">
  <h1>Keeping Order</h1>
  <div><p>&nbsp;</p></div>
  <table style="margin-left: auto; margin-right: auto;">
      <tr>
        <td>Testing</td><td>&#8594;</td><td><a href="https://travis-ci.org/NESCent/dplace">Travis</a>
<img src="https://travis-ci.org/NESCent/dplace.svg?branch=master"></td></tr>
        <td>Community development</td><td>&#8594;</td><td><a href="https://github.com/dleehr/dplace-vagrant">Vagrant</a> builds a VM</td></tr>
        <td>Interoperability</td><td>&#8594;</td><td><a href="http://p.printingchoice.com/8-examples-of-horrific-fine-print/">Free</a>* JSON API</td></tr>
    </table>
    <div><p>&nbsp;</p><p>&nbsp;</p></div>
  <p style="text-align: left; " class="fragment" data-fragment-index="1">
  <font color="#d9d9d9">* <font style="font-size: 24px;">API is not actually free. Processed on servers that also process peanuts. For best results, remove cap first. Do not eat iPod shuffle. Do not use while sleeping. Do not direct steam at &nbsp;people or animals or iron clothes while they are being worn.&nbsp;</font></font>
  </p>
</section>
<section data-autoslide="15000">
  <h1>Summary</h1>
  <div>One backend, opinionated</div>
  <div>Many frontends, modular, just REST clients</div>
        <div>Frontend is modular and agnostic</div>
        <div>
            <br>
        </div>
        <div>Fast development, still have control</div>
        <div>
            <br>
        </div>
        <div>
            <div>
                <a href="https://github.com/NESCent/dplace">github.com/NESCent/dplace</a>
            </div>
        </div>
        <div>
            <br>
        </div>
    </section>
</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.min.js"></script>

		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,
				autoSlide: 15000,

				theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

				// Parallax scrolling
				// parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
				// parallaxBackgroundSize: '2100px 900px',

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

    Reveal.addEventListener( 'fragmentshown', function( event ) {
      console.log(event.fragment);
        if(event.fragment.id == 'mapdiv') {
          $('#mapdiv').vectorMap('get','mapObject').setSize();
        }
    } );        

		</script>

	</body>
</html>
